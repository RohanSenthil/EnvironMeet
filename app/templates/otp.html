{% extends "user_base.html" %}
{% set active_page = "profile" %}
{% from '_formhelpers.html' import render_field %}
{% block title %}EnvironMeet - Login{% endblock %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename = 'styles/accounts.css')}}">
{% endblock %}
{% block content %}
<div class="content">
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  <div class='flashes'>
  {% for category, message in messages %}
  <div class="alert alert-{{ category }} " id='alert'>
  <span>{{ message }}</span>
  <button type="button" style='float:right;'class="btn-close" aria-label="Close" data-bs-dismiss="alert"></button>

  </div>

  {% endfor %}
  </div>
  {% endif %}
  {% endwith %}

  <h3 class="heading">OTP Valid for:</h3>

  <span class="timer" id="timer"></span>
  <progress max="{{ valid }}" value="{{ valid }}" class="progress progress--valid" id="progressBar"></progress>
  <input id="countdown" type="button" value="Resend OTP" onClick="window.location.reload(true)" style="visibility: hidden;">
  
  <script type="application/javascript">
    var timeInSecs;
    var ticker;

    function startTimer(secs) {
    timeInSecs = parseInt(secs);
    ticker = setInterval("tick()", 1000); 
    }

    function tick( ) {
    var secs = timeInSecs;
    if (secs > 0) {
    timeInSecs--; 
    }
    else {
    clearInterval(ticker);
    secs = document.getElementById("timer");
    startTimer(secs);

    var mins = Math.floor(secs/60);
    secs %= 60;
    var pretty = ( (mins < 10) ? "0" : "" ) + mins + ":" + ( (secs < 10) ? "0" : "" ) + secs;

    document.getElementById("countdown").innerHTML = pretty;
    }

    startTimer(5*60); // 4 minutes in seconds
//       const timerElement = document.getElementById("timer");
//       const progressBar = document.getElementById("progressBar")

//       var timerCounter = progressBar.max;

//       const interval = setInterval(() => {
//           if (timerCounter <= 1) {
//               document.getElementById("resend").style.visibility = "visible";;
//               clearInterval(interval);
//           }

//           timerCounter = timerCounter - 1;
          
//           timerElement.innerText = timerCounter + "s";
//           progressBar.value = timerCounter;
//       }, 1000);
  </script>

<form method="POST" action="">
  <input type="hidden" name="csrf_token" value="{{ csrf_token()Â }}"/>
    <br>
    <div class="form-outline mb-4">
      {{ render_field(form.num, class="form-control") }}
    </div>
    <div class="pt-1 mb-4">
      <input type="submit" value="Login" class="btn btn-dark p-2"/>
    </div>
  </form>
</div>
  {% endblock %}